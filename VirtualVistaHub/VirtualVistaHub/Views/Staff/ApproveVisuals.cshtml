@model VirtualVistaHub.Controllers.ImagesModel

<h2>Visual Details</h2>

@if (Model != null)
{
    <div>
        <h4>Property Details</h4>
        <hr />
        <dl class="dl-horizontal">
            <dt>Property Id</dt>
            <dd>@Html.DisplayFor(model => model.PropertyDetails.PropertyId)</dd>

            <dt>Coordinates Of VTour</dt>
            <dd>@Html.DisplayFor(model => model.PropertyDetails.VTour)</dd>

            <dt>User Id</dt>
            <dd>@Html.DisplayFor(model => model.PropertyDetails.UserId)</dd>
        </dl>

        <h4>Images</h4>
        <div class="image-gallery">
            @foreach (var imagePath in Model.ImagePaths)
            {
                <div class="image-item">
                    <img src="@Url.Content($"~/Uploads/{Model.TableName}/{imagePath}")" alt="Property Image" class="img-thumbnail" style="max-width: 200px;" />
                </div>
            }
        </div>

        <button type="button" class="btn btn-primary approve-decline-btn" data-property-id="@Model.PropertyDetails.PropertyId" data-bs-toggle="modal" data-bs-target="#approveDeclineModal">
            Approve/Decline
        </button>
    </div>
}
else
{
    <p>No property details found for the specified criteria.</p>
}

<div class="modal fade" id="approveDeclineModal" tabindex="-1" aria-labelledby="approveDeclineModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="approveDeclineModalLabel">Approve/Decline Property</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to approve or decline this property?</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="approvalStatus" id="approveRadio" value="approve" checked>
                    <label class="form-check-label" for="approveRadio">Approve</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="approvalStatus" id="declineRadio" value="decline">
                    <label class="form-check-label" for="declineRadio">Decline</label>
                </div>
                <div id="reasonInput" style="display: none;">
                    <label for="declineReason">Reason for Decline (Max 50 characters):</label>
                    <input type="text" class="form-control" id="declineReason" maxlength="50">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmApprovalBtn">Confirm</button>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            var propertyId;

            $('.approve-decline-btn').click(function () {
                propertyId = $(this).data('property-id');
            });

            $('input[name="approvalStatus"]').change(function () {
                if ($('#declineRadio').is(':checked')) {
                    $('#reasonInput').show();
                } else {
                    $('#reasonInput').hide();
                }
            });

            $('#confirmApprovalBtn').click(function () {
                var approvalStatus = $('input[name=approvalStatus]:checked').val();
                var reason = $('#declineReason').val();

                if (approvalStatus === "approve") {
                    window.location.href = '@Url.Action("Approve", "Staff")?propertyId=' + propertyId + '&approvedstatus=true';
                } else {
                    if (reason.length > 0 && reason.length <= 50) {
                        window.location.href = '@Url.Action("Approve", "Staff")?propertyId=' + propertyId + '&approvedstatus=false&approvedmessage=' + encodeURIComponent(reason);
                    } else {
                        alert("Please provide a reason for declining (Max 50 characters).");
                    }
                }
            });
        });
    </script>
}
